<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout - KOOLO</title>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
<script src="https://js.stripe.com/v3/"></script>
<style>
body{margin:0;background:#000;color:white;font-family:Arial,sans-serif;padding:30px;}
input{width:100%;padding:10px;margin:10px 0;background:#111;border:1px solid #333;color:white;border-radius:5px;}
button{padding:10px 20px;background:white;border:none;cursor:pointer;margin-top:15px;border-radius:5px;}
.order-summary{background:#111;padding:20px;margin-bottom:30px;border-radius:8px;}
</style>
</head>
<body>

<h1>Finalizar compra</h1>

<div class="order-summary">
  <h2>Resumen del pedido</h2>
  <div id="summary"></div>
  <h3>Total: <span id="total"></span> ‚Ç¨</h3>
</div>

<h2>Datos de env√≠o</h2>
<input type="text" id="name" placeholder="Nombre completo">
<input type="email" id="email" placeholder="Email">
<input type="text" id="address" placeholder="Direcci√≥n">
<input type="text" id="city" placeholder="Ciudad">
<input type="text" id="phone" placeholder="Tel√©fono">

<button onclick="payWithStripe()">Pagar con tarjeta</button>

<script>
const firebaseConfig={
  apiKey:"AIzaSyA7orSwoJ5XcDd-ABRj_o_OVySCdC05mxE",
  authDomain:"koolo2026.firebaseapp.com",
  projectId:"koolo2026",
  appId:"1:612039099714:web:38d14c2d43851c225c74db"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

let cart=JSON.parse(localStorage.getItem("checkoutCart"))||[];
let total=0;
const summary=document.getElementById("summary");
const totalEl=document.getElementById("total");

cart.forEach(item=>{total+=item.price;summary.innerHTML+=`<p>${item.name} - ${item.price} ‚Ç¨</p>`;});
totalEl.innerText=total.toFixed(2);

// üîπ FUNCION DE PAGO CON STRIPE
async function payWithStripe(){
  const stripe = Stripe("TU_PUBLIC_KEY_STRIPE"); // tu public key de Stripe
  const name=document.getElementById("name").value;
  const email=document.getElementById("email").value;
  const address=document.getElementById("address").value;
  const city=document.getElementById("city").value;
  const phone=document.getElementById("phone").value;

  if(cart.length===0){alert("Tu carrito est√° vac√≠o");return;}
  if(!name||!email||!address){alert("Completa los campos obligatorios");return;}

  try {
    // Guardar pedido como Pendiente
    const orderRef = await db.collection("orders").add({
      customer:{name,email,address,city,phone},
      items:cart,
      total:total,
      status:"Pendiente",
      date:new Date()
    });

    // REDIRECCIONAR A STRIPE PAYMENT LINK
    const stripeCheckoutURL="https://buy.stripe.com/test_xyz"; // reemplaza con tu Payment Link
    window.location.href=stripeCheckoutURL;

  } catch(error){
    console.error("Error al crear el pedido:",error);
    alert("Error al crear el pedido: "+error.message);
  }
}
</script>

</body>
</html>
