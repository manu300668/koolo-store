<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout - KOOLO</title>

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<style>
body{
  margin:0;
  background:#000;
  color:white;
  font-family:Arial;
  padding:30px;
}

input{
  width:100%;
  padding:10px;
  margin:10px 0;
  background:#111;
  border:1px solid #333;
  color:white;
}

button{
  padding:10px 20px;
  background:white;
  border:none;
  cursor:pointer;
  margin-top:15px;
}

.order-summary{
  background:#111;
  padding:20px;
  margin-bottom:30px;
}
</style>
</head>

<body>

<h1>Finalizar compra</h1>

<div class="order-summary">
  <h3>Resumen del pedido</h3>
  <div id="summary"></div>
  <h2>Total: <span id="total"></span> €</h2>
</div>

<h3>Datos de envío</h3>

<input type="text" id="name" placeholder="Nombre completo">
<input type="email" id="email" placeholder="Email">
<input type="text" id="address" placeholder="Dirección">
<input type="text" id="city" placeholder="Ciudad">
<input type="text" id="phone" placeholder="Teléfono">

<button onclick="submitOrder()">Confirmar pedido</button>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyA7orSwoJ5XcDd-ABRj_o_OVySCdC05mxE",
  authDomain: "koolo2026.firebaseapp.com",
  projectId: "koolo2026",
  appId: "1:612039099714:web:38d14c2d43851c225c74db"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let cart = JSON.parse(localStorage.getItem("checkoutCart")) || [];
let total = 0;

const summary = document.getElementById("summary");

cart.forEach(item=>{
  total += item.price;
  summary.innerHTML += `<p>${item.name} - ${item.price} €</p>`;
});

document.getElementById("total").innerText = total.toFixed(2);

function submitOrder(){

  const name = document.getElementById("name").value;
  const email = document.getElementById("email").value;
  const address = document.getElementById("address").value;
  const city = document.getElementById("city").value;
  const phone = document.getElementById("phone").value;

  if(!name || !email || !address){
    alert("Completa los campos obligatorios");
    return;
  }

  db.collection("orders").add({
    customer:{
      name,email,address,city,phone
    },
    items:cart,
    total:total,
    status:"Pendiente",
    date:new Date()
  })
  .then(()=>{
    alert("Pedido realizado correctamente ✅");
    localStorage.removeItem("checkoutCart");
    window.location.href="index.html";
  })
  .catch(error=>{
    alert("Error: " + error.message);
  });

}
</script>

</body>
</html>
